
(function($,window,document,undefined){var pluginName='jquery-grid-navigation';$.fn.gridNavigation=function gridNavigation(cellsSelector,options){options=$.extend({activeIndex:0,debug:false,wrap:false,autoReset:false,autoInit:true},options);return this.each(function onEachGridNavigationWidget(){if($.data(this,pluginName)===undefined){var $widget=$(this);var $allCells=$widget.find(cellsSelector);var numCells=$allCells.length;var $rows=$allCells.first().parent().parent().children();var $cols=$rows.first().children();var numCols=$cols.length;var numRows=$rows.length;var currentCol=null;var currentRow=null;if(options.activeIndex<0||options.activeIndex>=numCells){options.activeIndex=0;}
var hasDoneInit=function(){return currentCol!==null&&currentCol!==null;};var needsInit=function(){return options.autoInit===false&&hasDoneInit()===false;};var storeData=function(){$allCells.each(function(idx,itm){$.data(itm,pluginName,{index:idx});});};var getCellCoords=function(cell){var $cell=$(cell);return{col:$cell.index(),row:$cell.parent().index()};};var getCellIndex=function(cell){return(cell===null)?null:$.data(cell,pluginName).index;};var getCellByIndex=function(index){return(index===null)?null:$allCells.get(index);};var getCellByCoords=function(col,row){return(col!==null&&row!==null)?$rows.eq(row).children().eq(col).get(0):null;};var resetModel=function(){var fromCell=getCellByCoords(currentCol,currentRow);var fromCellIndex=getCellIndex(fromCell);var eventData={fromIndex:fromCellIndex,toIndex:null};currentRow=null;currentCol=null;$(fromCell).trigger("gridNavigationReset",eventData);};var initModel=function(){var fromCell=getCellByCoords(currentCol,currentRow);var fromCellIndex=getCellIndex(fromCell);var toCell=getCellByIndex(options.activeIndex);var toCellCoords=getCellCoords(toCell);var eventData;if(fromCellIndex!==options.activeIndex){eventData={fromIndex:fromCellIndex,toIndex:options.activeIndex};currentCol=toCellCoords.col;currentRow=toCellCoords.row;$(toCell).trigger("gridNavigationInit",eventData);}};var onFocusExit=function(e){if(currentRow!==null&&currentCol!==null){if(options.autoInit===false){resetModel();}else{initModel();}}};var updateModelByCoords=function(goToCol,goToRow){var currentCell=getCellByCoords(currentCol,currentRow);var currentCellData=$.data(currentCell,pluginName);var goToCell;var goToCellData;var boundary;var eventData;if(goToCol<0){boundary="left";}else if(goToCol>=numCols){boundary="right";}else if(goToRow<0){boundary="top";}else if(goToRow>=numRows){boundary="bottom";}
if(boundary===undefined){goToCell=getCellByCoords(goToCol,goToRow);goToCellData=$.data(goToCell,pluginName);eventData={fromIndex:currentCellData.index,toIndex:goToCellData?goToCellData.index:null};$(goToCell).trigger("gridNavigationChange",eventData);currentCol=goToCol;currentRow=goToRow;}else{eventData={fromIndex:currentCellData.index,toIndex:null,boundary:boundary};$(currentCell).trigger("gridNavigationBoundary",eventData);}};var updateModelByCol=function(colIndex){updateModelByCoords(colIndex,currentRow);};var updateModelByRow=function(rowIndex){updateModelByCoords(currentCol,rowIndex);};var updateModelByIndex=function(index){var $cell=$($allCells.get(index));numCells=$allCells.length;updateModelByCoords($cell.index(),$cell.parent().index());};var onGridNavigationItemsChange=function(){$allCells=$widget.find(cellsSelector);numCells=$allCells.length;$rows=$allCells.first().parent().parent().children();$cols=$rows.first().children();numCols=$cols.length;numRows=$rows.length;storeData();};var onArrowKeyDown=function(e){if(needsInit()===true){initModel();}else{switch(e.type){case"upArrowKeyDown":updateModelByRow(currentRow-1);break;case"downArrowKeyDown":updateModelByRow(currentRow+1);break;case"leftArrowKeyDown":updateModelByCol(currentCol-1);break;case"rightArrowKeyDown":updateModelByCol(currentCol+1);break;default:break;}}};$widget.commonKeyDown();$widget.on('upArrowKeyDown downArrowKeyDown rightArrowKeyDown leftArrowKeyDown',onArrowKeyDown);$widget.on('click',cellsSelector,function(e){var $this=$(this);if(needsInit()===true){initModel();}
updateModelByCoords($this.index(),$this.parent().index());});if(options.autoReset===true){$widget.focusExit();$widget.on('focusExit',onFocusExit);}
$widget.on('gridNavigationItemsChange',onGridNavigationItemsChange);if(options.autoInit===true){setTimeout(function(){initModel();},0);}
jQuery.data(this,pluginName,{installed:'true'});storeData();}else if(options.debug===true){console.log('debug: {pluginName} is already installed on {element}'.replace('{pluginName}',pluginName).replace('{element}',this));}});};}(jQuery,window,document));